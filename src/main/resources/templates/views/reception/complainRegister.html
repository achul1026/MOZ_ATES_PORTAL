<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="layouts/layout">

<div layout:fragment="content">
<!--	<div id="breadcrumb">-->
<!--		<ul>-->
<!--			<li>-->
<!--				<a th:href="@{/}">-->
<!--					<img th:src="@{/images/home.png}" alt="메인 페이지">-->
<!--				</a>-->
<!--			</li>-->
<!--			<li>-->
<!--				<img th:src="@{/images/arrow-right.png}" alt="다음">-->
<!--			</li>-->
<!--			<li>-->
<!--				<a th:href="@{/complain/list.do}" th:text="#{reception.complainInfo.title.complainInfo}">-->
<!--					서브페이지-->
<!--				</a>-->
<!--			</li>-->
<!--			<li>-->
<!--				<img th:src="@{/images/arrow-right.png}" alt="다음">-->
<!--			</li>-->
<!--			<li>-->
<!--				<a href="" th:text="#{reception.complainRegist.title}">-->
<!--					서브페이지-->
<!--				</a>-->
<!--			</li>-->
<!--		</ul>-->
<!--	</div>-->
	<div id="container">
		<h2 id="page-title" th:text="#{reception.complainRegist.title}">민원</h2>
		
		<form id="complaintsRegistForm">
			<div class="cm-info-wrap">
				<h1 th:text="#{reception.complainRegist.user.title}">민원 신청인 정보</h1>
				<div class="cm-input-wrap">
					<div class="cm-input-list">
						<dl>
							<dt>
								<label class="control-label" for="wrtrNm" th:text="#{reception.complainRegist.user.name}">이름</label>
							</dt>
							<dd>
								<input type="text" id="wrtrNm" name="wrtrNm" class="detail-input form-control data-validate"
									th:data-valid-name="#{reception.complainRegist.user.name}" data-valid-minimum="3" data-valid-maximum="50" data-valid-required>
							</dd>
						</dl>
					</div>
					<div class="cm-input-list">
						<dl>
							<dt>
								<label class="control-label" for="wrtrPno" th:text="#{reception.complainRegist.user.phone}">핸드폰
									번호</label>
							</dt>
							<dd>
								<input type="text" id="wrtrPno" name="wrtrPno" class="detail-input form-control data-validate"
									th:data-valid-name="#{reception.complainRegist.user.phone}" data-valid-required>
							</dd>
						</dl>
					</div>
				</div>

			</div>
			<div class="cm-info-wrap">
				<h1 th:text="#{reception.complainRegist.detail}">민원내용</h1>
				<div class="cm-input-wrap">
					<div class="cm-input-list">
						<dl>
							<dt>
								<label class="control-label" for="postTtl" th:text="#{reception.complainRegist.subject}">제목</label>
							</dt>
							<dd>
								<input type="text" id="postTtl" name="postTtl" class="detail-input form-control data-validate" 
									th:data-valid-name="#{reception.complainRegist.subject}" data-valid-required>
							</dd>
						</dl>
					</div>
					<div class="cm-input-list">
						<dl>
							<dt>
								<label class="control-label" for="postPw"
									th:text="#{reception.complainRegist.password}">Password</label>
							</dt>
							<dd>
								<input type="password" id="postPw" name="postPw" placeholder="" class="detail-input form-control data-validate"
									th:data-valid-name="#{reception.complainRegist.password}" data-valid-required maxlength="10">
							</dd>
						</dl>
					</div>

					<div class="cm-input-list">
						<dl>
							<dt>
								<label class="control-label" for="cateCd"
									th:text="#{reception.complainRegist.category}">카테고리</label>
							</dt>
							<dd>
								<select class="base-select" name="cateCd" id="cateCd">
									<th:block th:each="cateItm : ${complaintsCate}">
										<option th:value="${cateItm.cdId}" th:text="${cateItm.cdNm}">All</option>
									</th:block>
								</select>
							</dd>
						</dl>
					</div>
					
					<!-- TODO :: File Upload -->
					<div class="cm-input-list">
						<dl>
							<dt class="textarea-top">
								<label class="control-label" for="postCn" th:text="#{reception.complainRegist.file}">첨부파일</label>
							</dt>
							<dd id="file-wrap">
								<div class="file-inner">
									<input class="upload-name" th:value="#{reception.complainRegist.file}" readonly
										th:placeholder="#{reception.complainRegist.file}">
									<button type="button" th:text="#{reception.complainRegist.file.search}" class="fileUpBtn" onclick="fileUpload()">파일찾기</button>
									<input type="file" id="uploadFiles"  multiple accept="image/jpeg, image/png" style="display: none;">
								</div>
								<p class="file-text" th:text="#{reception.complainRegist.file.rules}">
									*파일첨부는 n개까지 가능, 총 (n)MB이하로 첨부하여 주세요. 첨부 가능 확장자 (*hwp,hwpx,…)
								</p>

								<div class="uploadWrap none">
									<div id="uploadListContainer"></div>	
								</div>
							</dd>
						</dl>
					</div>
					
					<div class="cm-input-list">
						<dl>
							<dt class="textarea-top">
								<label class="control-label" for="postCn" th:text="#{reception.complainRegist.textarea.txt}">내용</label>
							</dt>
							<dd>
								<textarea class="form-control base-textarea data-validate" id="postCn" name="postCn" rows="6"
									th:placeholder="#{reception.complainRegist.textarea.placeholder.txt}"
									th:data-valid-name="#{reception.complainRegist.textarea.txt}" data-valid-required></textarea>
							</dd>
						</dl>
					</div>
					
				</div>
			</div>
		</form>
		
		<div class="btn-wrap-end">
			<button type="button" class="sub-btn out-btn" th:text="#{reception.common.list.more}">List</button>
			<button type="button" class="main-btn out-btn" th:text="#{reception.common.submit}" onclick="registComplaints()">Submit</button>
		</div>
	</div>

	
</div>
</div>

</html>
<script type="text/javascript" th:inline="javascript">

	function registComplaints() {

		if (soValid("complaintsRegistForm")) {
			const formData = new FormData(document.getElementById('complaintsRegistForm'));

			const fileList = document.getElementById("uploadFiles").files;
			if (fileList.length > 0) {
				for (const file of fileList) {
					let fileReg = /(.*?)\.(jpg|jpeg|png)$/;
					let maxSize = 20 * 1024 * 1024;
					if (!fileReg.test(file.name)) {
				        alert('Only Images File');
				        return false;
				    } 
				    else if (file.size > maxSize) {
				        alert('Image size is too large');
				        return false;
				    }
					
					formData.append("files", file);
				}
			}
			fetch('/complain/save.ajax', {
				method: "post",
				body: formData
			})
				.then(response => response.json())
				.then((result) => {
					if (result.code === 200) {
						alert(result.message);
						location.href="/complain/list.do";
					} else {
						alert(result.message);
					}
				});
				
		}
	}
	
</script>